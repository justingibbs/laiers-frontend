<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Job Matching App</title>
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
    <link rel="stylesheet" href="/static/css/styles.css" />

</head>

<body>
    {% include "components/header.html" %}

    <div class="user-info">
        <h2>Welcome, {{ user_profile.profile.name or user.email }}</h2>
        <span class="user-type">{{ user_profile.user_type | title }}</span>
        <pre>{{ user_profile.profile.name }}</pre>
<pre>{{ user.email }}</pre>

    </div>
    <div class="content">
        <!-- Profile Information Panel -->
        <div class="profile-card">
            <div class="profile-header">
                <h2 class="profile-title">Profile Information</h2>
            </div>

            <div class="profile-section">
                <h3>Basic Information</h3>
                <div class="profile-field">
                    <span class="field-label">Email:</span>
                    <span class="field-value">{{ user_profile.email }}</span>
                </div>
                <div class="profile-field">
                    <span class="field-label">User Type:</span>
                    <span class="field-value">{{ user_profile.user_type | title }}</span>
                </div>
                
                {% if user_profile.profile.name %}
                <div class="profile-field">
                    <span class="field-label">Name:</span>
                    <span class="field-value">{{ user_profile.profile.name }}</span>
                </div>
                {% endif %}
            </div>

            {% if user_profile.user_type == 'talent' %}
            <div class="profile-section">
                <h3>Professional Information</h3>
                {% if user_profile.profile.skills %}
                <div class="profile-field">
                    <span class="field-label">Skills:</span>
                    <span class="field-value">{{ user_profile.profile.skills | join(', ') }}</span>
                </div>
                {% endif %}
                {% if user_profile.profile.experience_level %}
                <div class="profile-field">
                    <span class="field-label">Experience Level:</span>
                    <span class="field-value">{{ user_profile.profile.experience_level }}</span>
                </div>
                {% endif %}
            </div>

            <div class="profile-section">
                <h3>Job Opportunities</h3>
                <div class="profile-field">
                    <span class="field-label">Browse Jobs:</span>
                    <span class="field-value">
                        <a href="/opportunities" style="color: #1976d2; text-decoration: none; font-weight: 500;">
                            üöÄ View Available Opportunities ‚Üí
                        </a>
                    </span>
                </div>
                <div class="profile-field" style="margin-top: 0.75rem;">
                    <span class="field-value" style="color: #666; font-size: 0.9rem;">
                        Discover exciting career opportunities from top companies and apply with personalized
                        applications.
                    </span>
                </div>
            </div>
            {% endif %}

            {% if user_profile.user_type == 'company' %}
            <div class="profile-section">
                <h3>Company Information</h3>
                {% if user_profile.profile.company %}
                <div class="profile-field">
                    <span class="field-label">Company Name:</span>
                    <span class="field-value">{{ user_profile.profile.company }}</span>
                </div>
                {% endif %}
                {% if user_profile.company_id %}
                <div class="profile-field">
                    <span class="field-label">Company Portal:</span>
                    <span class="field-value">
                        <a href="/company/{{ user_profile.company_id }}"
                            style="color: #1976d2; text-decoration: none; font-weight: 500;">
                            üè¢ Visit {{ user_profile.company_name }} Portal ‚Üí
                        </a>
                    </span>
                </div>
                {% endif %}
                {% if user_profile.profile.industry %}
                <div class="profile-field">
                    <span class="field-label">Industry:</span>
                    <span class="field-value">{{ user_profile.profile.industry }}</span>
                </div>
                {% endif %}
            </div>
            {% endif %}

            <!-- Debug Info (remove in production) -->
            <div class="profile-section" style="border-top: 1px solid #eee; padding-top: 1rem; margin-top: 1rem;">
                <h3>Development</h3>
                <div class="profile-field">
                    <span class="field-label">User ID:</span>
                    <span class="field-value" style="font-family: monospace; font-size: 0.8em;">{{ user.uid }}</span>
                </div>
                <div class="profile-field">
                    <span class="field-label">ADK Dev UI:</span>
                    <span class="field-value">
                        <a href="/adk/dev-ui/" target="_blank" style="color: #1976d2;">Open ADK Interface</a>
                    </span>
                </div>
            </div>
        </div>

        <!-- AI Chat Assistant Panel -->
        <div class="chat-card">
            <div class="chat-header">
                <h2 class="chat-title">ü§ñ AI Job Assistant</h2>
            </div>

            <div id="chat-messages" class="chat-messages">
                <div class="welcome-message">
                    <p><strong>üëã Hi there! I'm your AI job assistant.</strong></p>
                    <p>
                        {% if user_profile.user_type == 'talent' %}
                        I'm here to help you with <strong>job searching</strong>, <strong>resume optimization</strong>,
                        <strong>interview prep</strong>, and <strong>career advice</strong>.
                        {% else %}
                        I'm here to help you with <strong>job postings</strong>, <strong>candidate screening</strong>,
                        <strong>hiring strategies</strong>, and <strong>recruitment best practices</strong>.
                        {% endif %}
                    </p>
                    <p>How can I assist you today?</p>
                </div>
            </div>

            <form class="chat-form" hx-post="/api/chat" hx-target="#chat-messages" hx-swap="beforeend"
                hx-trigger="submit" hx-indicator=".loading-indicator">
                <input type="text" name="message" class="chat-input"
                    placeholder="Ask me anything about jobs and careers..." required autocomplete="off">
                <button type="submit" class="chat-button">
                    Send
                    <span class="htmx-indicator loading-indicator"> ...</span>
                </button>
            </form>
        </div>
    </div>

    <script>
        // Clear form after successful submission
        document.body.addEventListener('htmx:afterRequest', function (event) {
            if (event.detail.xhr.status === 200 && event.detail.elt.matches('.chat-form')) {
                event.detail.elt.reset();

                // Scroll to bottom of chat
                const chatMessages = document.getElementById('chat-messages');
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }
        });

        // Handle logout response
        document.body.addEventListener('htmx:afterRequest', function (event) {
            if (event.detail.elt.matches('.sign-out') && event.detail.xhr.status === 200) {
                try {
                    const response = JSON.parse(event.detail.xhr.responseText);
                    if (response.redirect) {
                        window.location.href = response.redirect;
                    }
                } catch (e) {
                    window.location.href = '/';
                }
            }
        });

        // Auto-scroll chat messages
        const chatMessages = document.getElementById('chat-messages');
        if (chatMessages) {
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
    </script>
</body>

</html>